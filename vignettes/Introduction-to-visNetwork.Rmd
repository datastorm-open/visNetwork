---
title: "Introduction to visNetwork"
author: "B. Thieurmel - DataKnowledge"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

**visNetwork** is a R package for network visualization, using **vis.js** javascript library (http://visjs.org/). All the remarks and bugs returns are welcome on github : https://github.com/DataKnowledge/visNetwork.

## Minimal example

**visNetwork** needs at least two informations :

* a nodes data.frame, with *id* column
* a edges data.frame, with *from* and *to* columns

```{r}
require(visNetwork, quietly = TRUE)
# minimal example
nodes <- data.frame(id = 1:3)
edges <- data.frame(from = c(1,2), to = c(1,3))
visNetwork(nodes, edges, width = "100%")
```


## Simple individual nodes and edges customization

* Adding more variables on nodes data.frame. See **_visNodes_** for available options.

```{r}
nodes <- data.frame(id = 1:10, 
                    label = paste("Node", 1:10),                                 # add labels on nodes
                    group = c("GrA", "GrB"),                                     # add groups on nodes 
                    value = 1:10,                                                # size adding value
                    shape = c("square", "triangle", "box", "circle", "dot", "star",
                    "ellipse", "database", "text", "diamond"),                   # control shape of nodes
                    title = paste0("<p><b>", 1:10,"</b><br>Node !</p>"),         # tooltip (html or character)
                    color = c("darkred", "grey", "orange", "darkblue", "purple"),# color
                    shadow = c(FALSE, TRUE, FALSE, TRUE, TRUE))                  # shadow

head(nodes)
```

* Adding more variables on edges data.frame. See **_visEdges_** for available options.

```{r}
edges <- data.frame(from = sample(1:10,8), to = sample(1:10, 8),
                    label = paste("Edge", 1:8),                                 # add labels on edges
                    length = c(100,500),                                        # length
                    arrows = c("to", "from", "middle", "middle;to"),            # arrows
                    dashes = c(TRUE, FALSE),                                    # dashes
                    title = paste("Edge", 1:8),                                 # tooltip (html or character)
                    smooth = c(FALSE, TRUE),                                    # smooth
                    shadow = c(FALSE, TRUE, FALSE, TRUE))                       # shadow
head(edges)
```

```{r}
visNetwork(nodes, edges, width = "100%")
```

## Global nodes/edges configuration

* Set global options for nodes and edges using **_visNodes_** and **_visEdges_**, and use options per group using **_visGroups_**.

```{r}
nodes <- data.frame(id = 1:5, group = c(rep("A", 2), rep("B", 3)))
edges <- data.frame(from = c(2,5,3,3), to = c(1,2,4,2))

visNetwork(nodes, edges) %>% 
  visNodes(shape = "square") %>%                        # square for all nodes
  visEdges(arrow ="to") %>%                             # arrow "to" for all edges
  visGroups(groupname = "A", color = "darkblue") %>%    # darkblue for group "A"
  visGroups(groupname = "B", color = "red")             # red for group "B"
```

# Network configuration
Configuration options are available in *visOptions*, *visInteraction*, *visLayout*, *visHierarchicalLayout*, *visPhysics* :


```{r, echo=FALSE}
nb <- 10
nodes <- data.frame(id = 1:nb, label = paste("Label", 1:nb),
 group = sample(LETTERS[1:3], nb, replace = TRUE), value = 1:nb,
 title = paste0("<p>", 1:nb,"<br>Tooltip !</p>"), stringsAsFactors = FALSE)

edges <- data.frame(from = trunc(runif(nb)*(nb-1))+1,
 to = trunc(runif(nb)*(nb-1))+1,
 value = rnorm(nb, 10), label = paste("Edge", 1:nb),
 title = paste0("<p>", 1:nb,"<br>Edge Tooltip !</p>"))
```

## Highlight nearest
Highlight nearest nodes and edges clicking on a node :

```{r}
visNetwork(nodes, edges, width = "100%") %>% visOptions(highlightNearest = TRUE)
```

## Add legend on groups
```{r}
visNetwork(nodes, edges, width = "100%",  legend = TRUE)
```

## Select by node id
```{r}
visNetwork(nodes, edges, width = "100%") %>% visOptions(highlightNearest = TRUE, nodesIdSelection = TRUE)
```

## Directed Network
```{r, echo = FALSE}
nodes <- data.frame(id = 1:nb, label = paste("Label", 1:nb),
 group = sample(1:nb, nb, replace = TRUE), value = 1:nb,
 title = paste0("<p>", 1:nb,"<br>Tooltip !</p>"), stringsAsFactors = FALSE)

edges <- data.frame(from = trunc(runif(nb)*(nb-1))+1,
 to = trunc(runif(nb)*(nb-1))+1,
 title = paste0("<p>", 1:nb,"<br>Edge Tooltip !</p>"))
```

```{r}
visNetwork(nodes, edges, width = "100%") %>% visEdges(arrow = 'from')
```

## Custom navigation
*vis.js* propose some navigation tools :

```{r}
visNetwork(nodes, edges, width = "100%") %>% visInteraction(navigationButtons = TRUE)
```

## Data Manipulation
And some data manipulation tools :

```{r}
visNetwork(nodes, edges, width = "100%") %>% visOptions(manipulation = TRUE)
```

## Hierarchical Layout
You can use and control hierarchical layout with *visHierarchicalLayout* and *visLayout* :

```{r, echo = FALSE}
nodes <- data.frame(id = 1:7)

edges <- data.frame(from = c(1,2,2,2,3,3),
 to = c(2,3,4,5,6,7))
```

```{r}
visNetwork(nodes, edges, width = "100%") %>% visEdges(arrow = "from") %>% 
  visHierarchicalLayout() # same as   visLayout(hierarchical = TRUE) 

visNetwork(nodes, edges, width = "100%") %>% visEdges(arrow = "from") %>% 
  visHierarchicalLayout(direction = "LR")
```

## Freeze network
```{r}
visNetwork(nodes, edges, width = "100%") %>% 
  visInteraction(dragNodes = FALSE, dragView = FALSE, zoomView = FALSE)
```


# Additional features

## Export

```{r, eval = FALSE}
network <- visNetwork(nodes, edges, width = "100%")
htmlwidgets::saveWidget(network, "network.html")
```

## Use DOT language data 

```{r}
visNetwork(dot = 'dinetwork {1 -> 1 -> 2; 2 -> 3; 2 -- 4; 2 -> 1 }', width = "100%")
```

## Use gephi json export file

```{r, eval = FALSE}
# don't run here
visNetwork(gephi = 'WorldCup2014.json')
```

## Physics, tooltip, events, shiny, ...

You can also control :

* physics of network : *visPhysics*
* events : *visEvents*

And use in shiny apps with *visNetworkOutput* and *renderVisNetwork*. Using with shiny, and enabled options *nodesIdSelection*, you can access to new input with current selection value

```{r, eval = FALSE}
output$mynetwork <- renderVisNetwork({... visOptions(nodesIdSelection = TRUE)}) # created input$mynetwork_selected

```
